<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>缓存 | 张彩蝶的博客</title>
    <meta name="description" content="张彩蝶的个人网站">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/0.styles.34c016ef.css" as="style"><link rel="preload" href="/assets/js/app.8da0b9c8.js" as="script"><link rel="preload" href="/assets/js/2.b793fb40.js" as="script"><link rel="preload" href="/assets/js/4.4a21ae77.js" as="script"><link rel="prefetch" href="/assets/js/10.6d632027.js"><link rel="prefetch" href="/assets/js/11.b0df11e6.js"><link rel="prefetch" href="/assets/js/12.6d682003.js"><link rel="prefetch" href="/assets/js/13.f7af719e.js"><link rel="prefetch" href="/assets/js/14.4773d2f2.js"><link rel="prefetch" href="/assets/js/15.909375d6.js"><link rel="prefetch" href="/assets/js/16.807fa53b.js"><link rel="prefetch" href="/assets/js/17.03c19599.js"><link rel="prefetch" href="/assets/js/18.90141c21.js"><link rel="prefetch" href="/assets/js/19.02f4287f.js"><link rel="prefetch" href="/assets/js/20.b9e8c61c.js"><link rel="prefetch" href="/assets/js/21.716bd9ad.js"><link rel="prefetch" href="/assets/js/22.2cdd7126.js"><link rel="prefetch" href="/assets/js/23.d4c83b6b.js"><link rel="prefetch" href="/assets/js/3.e0f4a456.js"><link rel="prefetch" href="/assets/js/5.e76745e8.js"><link rel="prefetch" href="/assets/js/6.7e2533e5.js"><link rel="prefetch" href="/assets/js/7.5c09c673.js"><link rel="prefetch" href="/assets/js/8.01b420a3.js"><link rel="prefetch" href="/assets/js/9.2596c76a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.34c016ef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">张彩蝶的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/js/" class="sidebar-heading clickable router-link-active open"><span>js</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/js/this和call、apply、bind.html" class="sidebar-link">this和call、apply、bind</a></li><li><a href="/js/缓存.html" class="active sidebar-link">缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js/缓存.html#浏览器缓存：强缓存和协商缓存" class="sidebar-link">浏览器缓存：强缓存和协商缓存</a></li><li class="sidebar-sub-header"><a href="/js/缓存.html#cdn缓存" class="sidebar-link">CDN缓存</a></li></ul></li><li><a href="/js/同源和跨域.html" class="sidebar-link">同源和跨域</a></li><li><a href="/js/XSS和CSRF.html" class="sidebar-link">XSS和CSRF</a></li><li><a href="/js/cookie.html" class="sidebar-link">cookie</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/css/" class="sidebar-heading clickable"><span>css</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/解题/" class="sidebar-heading clickable"><span>解题</span> <span class="arrow right"></span></a> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="缓存"><a href="#缓存" aria-hidden="true" class="header-anchor">#</a> 缓存</h1> <h2 id="浏览器缓存：强缓存和协商缓存"><a href="#浏览器缓存：强缓存和协商缓存" aria-hidden="true" class="header-anchor">#</a> 浏览器缓存：强缓存和协商缓存</h2> <h4 id="场景描述（为加深理解写的小故事，不感兴趣可跳过哦）"><a href="#场景描述（为加深理解写的小故事，不感兴趣可跳过哦）" aria-hidden="true" class="header-anchor">#</a> 场景描述（为加深理解写的小故事，不感兴趣可跳过哦）</h4> <p>AA ———— 一个有电脑的普通人。<br>
LL ———— AA电脑上唯一的浏览器。
现在我们把AA的浏览器LL拟人化。LL是AA的仆人。<br>
AA：LL，给我打开www.bb.com！我要看小说。<br>
LL：好嘞主人，马上就来！<br>
LL是一个聪明又敬业的仆人。因为AA总是让他打开网页，所以他有自己的一套应对办法。<br>
LL在自己身上装了一个小本子。每当AA让他打开页面的时候，他都会把这个页面的信息记下来。LL和服务器是好基友，他们约定了一套规则来给彼此减轻工作负担。<br>
这个规则是这样的：<br>
每当LL要打开一个页面前，先到自己的小本子上看一下，是不是有这个页面的记录？如果有，看一下这条记录过期时间。<br>
如果没有过期，LL就直接把这个页面拿给AA，不用再打电话让服务器传过来了。<br>
如果过期了，LL就打电话给服务器说：我家主人要这个页面，我这里存储的这个页面的tag是12，快帮我看看这个页面现在的tag是多少，没改我直接给他这个页面，你不用传来了。改了的话你就把最新的页面传给我，我把最新的tag和页面记上。<br>
如果压根没有这个页面的记录，那LL就会直接打电话跟服务器说：我家主人现在要这个页面，我这没有这个页面的记录，快给我最新的页面和tag，我拿给他顺便存一下。</p> <h4 id="场景分析"><a href="#场景分析" aria-hidden="true" class="header-anchor">#</a> 场景分析</h4> <h4 id="浏览器为什么要有缓存策略？"><a href="#浏览器为什么要有缓存策略？" aria-hidden="true" class="header-anchor">#</a> 浏览器为什么要有缓存策略？</h4> <ol><li>更快的响应用户（主人），减少不必要的与服务器交流的时间，以及带宽传输数据的时间。</li> <li>节约用户流量（电话费），减少不必要的数据传输流量。</li> <li>为服务器（好基友）减少压力——如果走了强缓存压根都不用向服务器发起请求，如果走了协商缓存也只需要服务器返回respondheader
以上为用户和服务器都来了很大好处。</li></ol> <h4 id="浏览器的缓存策略经过哪些步骤？"><a href="#浏览器的缓存策略经过哪些步骤？" aria-hidden="true" class="header-anchor">#</a> 浏览器的缓存策略经过哪些步骤？</h4> <p>总结流程图如下：
<img src="/assets/img/cache-1.515586b8.png" alt="浏览器缓存流程图"></p> <h4 id="用户怕浏览器缓存有问题，想跳过浏览器的缓存策略可以怎么做？"><a href="#用户怕浏览器缓存有问题，想跳过浏览器的缓存策略可以怎么做？" aria-hidden="true" class="header-anchor">#</a> 用户怕浏览器缓存有问题，想跳过浏览器的缓存策略可以怎么做？</h4> <p>F5刷新或者点击浏览器工具栏刷新按钮，会跳过强缓存。<br>
control+F5会跳过强缓存和协商缓存，重新获取资源。<br>
通过浏览器历史记录，清除浏览数据。</p> <h4 id="缓存存在了哪里？"><a href="#缓存存在了哪里？" aria-hidden="true" class="header-anchor">#</a> 缓存存在了哪里？</h4> <ul><li>disk cache
<ul><li>存储在硬盘中的缓存，资源相对稳定，不会随着tab或浏览器的关闭而消失，用来存储大型的，需要长久使用的资源。当硬盘中的资源被加载时，内存中也存储了该资源，当下次改资源被调用时，会优先从memory cache中读取，加快资源的获取</li></ul></li> <li>memory cache
<ul><li>存储在内存中的缓存，内存中的内容会随着tab的关闭而释放。</li></ul></li></ul> <p>当你访问chrome中的URL时，页面上的HTML和其他资源（如图像）将本地存储在内存和磁盘缓存中。Chrome将首先使用内存缓存，因为它的速度快得多，但它也会将页面存储在磁盘缓存中，以防您退出浏览器或它崩溃，因为磁盘缓存是持久的。</p> <ul><li>三级缓存原理
<ul><li>先去内存看，如果有，直接加载</li> <li>如果内存没有，择取硬盘获取，如果有直接加载</li> <li>如果硬盘也没有，那么就进行网络请求</li> <li>加载到的资源缓存到硬盘和内存，下次请求可以快速从内存中获取到</li></ul></li></ul> <h4 id="怎么合理应用浏览器缓存？"><a href="#怎么合理应用浏览器缓存？" aria-hidden="true" class="header-anchor">#</a> 怎么合理应用浏览器缓存？</h4> <p>强制缓存优先级最高，并且资源的改动在缓存有效期内都不会对缓存产生影响，因此该方法适用于大型且不易修改的的资源文件，例如第三方CSS、JS文件或图片资源，文件后可以加上hash进行版本的区分。建议将此类大型资源存入disk cache，因为存在硬盘中的文件资源不易丢失。比如静态网站的js、css文件等。</p> <p>协商缓存灵活性高，适用于数据的缓存，采用Etag标识进行对比灵活度最高，并考虑将数据存入内存中，因为内存加载速最快，并且数据体积小，不会占用大量内存资源。比如静态网站的html入口文件。</p> <h2 id="cdn缓存"><a href="#cdn缓存" aria-hidden="true" class="header-anchor">#</a> CDN缓存</h2> <h4 id="场景描述（为加深理解写的小故事，不感兴趣可跳过哦）-2"><a href="#场景描述（为加深理解写的小故事，不感兴趣可跳过哦）-2" aria-hidden="true" class="header-anchor">#</a> 场景描述（为加深理解写的小故事，不感兴趣可跳过哦）</h4> <p>AA：LL，打开www.cc.com，我要看最新的cc江湖录！<br>
LL：好的主人，马上就给你！<br>
LL给CC打电话，发现CC远在万里之外，连通花的时间多了点。而且CC网站上刚有一位亿万级作者更新小说，现在给他打电话的超级多，导致回应也略慢了些。<br>
LL办完正事后：CC老兄，你这样也太累了，能不能在咱俩中间设个站点NN，我问NN要东西，他再问你要得了。<br>
CC：你这方案也不顶事呀，我的工作量貌似并没有减少多少，除了距离短了些。<br>
LL：你傻呀，咱俩都能搞个办法缓存，就不能让NN也存上，没过期就直接传给我，你不轻省多了。<br>
CC：好主意！就这么办吧！</p> <h4 id="场景分析-2"><a href="#场景分析-2" aria-hidden="true" class="header-anchor">#</a> 场景分析</h4> <h4 id="cdn的缓存策略是什么样的？"><a href="#cdn的缓存策略是什么样的？" aria-hidden="true" class="header-anchor">#</a> CDN的缓存策略是什么样的？</h4> <p>cdn缓存策略与上文中浏览器的强缓存策略相似。CDN边缘节点接收到请求后，会检测自己是否有该资源的缓存，以及该资源是否过期。如未过期，直接返回给浏览器。若过期，向源站服务器请求新的资源并缓存下来。<br>
CDN边缘节点缓存策略因服务商不同而不同，但一般都会遵循http标准协议，通过http响应头中的Cache-control: max-age的字段来设置CDN边缘节点数据缓存时间。</p> <h4 id="使用cdn缓存后，一个完整的请求过程是怎样的？"><a href="#使用cdn缓存后，一个完整的请求过程是怎样的？" aria-hidden="true" class="header-anchor">#</a> 使用CDN缓存后，一个完整的请求过程是怎样的？</h4> <p>总结流程图如下：
<img src="/assets/img/cache-2.852624b9.png" alt="使用CDN缓存的请求流程图"></p> <h4 id="使用cdn分发有什么好处？"><a href="#使用cdn分发有什么好处？" aria-hidden="true" class="header-anchor">#</a> 使用CDN分发有什么好处？</h4> <ol><li>为用户非配最近，负载最小的服务器，降低访问延时，更快的响应用户，更小的流量消耗。</li> <li>为源站服务器分流减压。</li></ol> <h4 id="将资源放到cdn上需要注意什么？"><a href="#将资源放到cdn上需要注意什么？" aria-hidden="true" class="header-anchor">#</a> 将资源放到CDN上需要注意什么？</h4> <p>更新问题：当源站更新文件后，缓存服务器很可能因为缓存的过期时间未到而不向源站服务器请求。这导致返回给浏览器的仍然是旧文件。所以源站在更新文件时，应手动刷新资源。静态页面引用的资源，应以hash名方式发布。</p> <h3 id="参考文章"><a href="#参考文章" aria-hidden="true" class="header-anchor">#</a> 参考文章</h3> <p><a href="https://www.jianshu.com/p/9c95db596df5" target="_blank" rel="noopener noreferrer">彻底弄懂强缓存与协商缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://juejin.im/post/5c417993f265da61285a6075" target="_blank" rel="noopener noreferrer">前端之浏览器缓存，一次搞定<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.jianshu.com/p/47f3406c8084" target="_blank" rel="noopener noreferrer">浏览器缓存、HTTP缓存（强缓存、协商缓存），浏览器缓存和CDN的关系<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://segmentfault.com/a/1190000017930248" target="_blank" rel="noopener noreferrer">从前端角度理解缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://juejin.im/post/5ae081aaf265da0b767d263a" target="_blank" rel="noopener noreferrer">你应该知道的前端——缓存<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br> <a href="https://www.cnblogs.com/blogbyhuer/p/9335257.html" target="_blank" rel="noopener noreferrer">关于CDN与缓存（浏览器和CDN）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/js/this和call、apply、bind.html" class="prev">
          this和call、apply、bind
        </a></span> <span class="next"><a href="/js/同源和跨域.html">
          同源和跨域
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8da0b9c8.js" defer></script><script src="/assets/js/2.b793fb40.js" defer></script><script src="/assets/js/4.4a21ae77.js" defer></script>
  </body>
</html>
